<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestionar Aplicaciones - My Store (PRO)</title>

  <style>
    /* -------------------------
       Paleta y variables
       ------------------------- */
    :root{
      --primary:#6366f1;
      --primary-600:#4f46e5;
      --accent:#06b6d4;
      --danger:#ef4444;
      --bg-light: linear-gradient(135deg,#eef2ff,#fff7ed);
      --bg-dark: linear-gradient(135deg,#0f1724,#1e293b);
      --card-light:#ffffff;
      --card-dark:#0b1220;
      --text-light:#0f1724;
      --text-dark:#f8fafc;
      --glass: rgba(255,255,255,0.6);
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}

    /* -------------------------
       Base
       ------------------------- */
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg-light);
      color:var(--text-light);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }
    body.dark{
      background:var(--bg-dark);
      color:var(--text-dark);
    }

    a{color:var(--primary); text-decoration:none;}
    img{display:block; max-width:100%;}

    /* -------------------------
       Burbujas de fondo
       ------------------------- */
    .bubble{
      position:fixed;
      bottom:-200px;
      border-radius:50%;
      filter: blur(8px);
      opacity:0.6;
      z-index:0;
      animation:rise 18s linear infinite;
      pointer-events:none;
    }
    .bubble.b1{left:6%; width:120px; height:120px; background:linear-gradient(135deg,var(--primary),var(--accent)); animation-duration:20s;}
    .bubble.b2{left:28%; width:80px; height:80px; background:linear-gradient(135deg,#a78bfa,#7dd3fc); animation-duration:16s; animation-delay:2s;}
    .bubble.b3{left:50%; width:140px; height:140px; background:linear-gradient(135deg,#60a5fa,#c084fc); animation-duration:22s; animation-delay:4s;}
    .bubble.b4{left:72%; width:90px; height:90px; background:linear-gradient(135deg,#34d399,#60a5fa); animation-duration:18s; animation-delay:6s;}
    .bubble.b5{left:90%; width:110px; height:110px; background:linear-gradient(135deg,#fb7185,#f97316); animation-duration:24s; animation-delay:8s;}

    @keyframes rise{
      0%{transform:translateY(0) scale(1); opacity:0.8;}
      100%{transform:translateY(-130vh) scale(1.2); opacity:0;}
    }

    /* -------------------------
       Splash screen
       ------------------------- */
    .splash{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column;
      background:linear-gradient(135deg,#111827,#1f2937);
      color:white; z-index:9999;
    }
    .splash .logo{width:110px; height:110px; border-radius:18px; background:white; display:flex; align-items:center; justify-content:center; margin-bottom:16px; box-shadow:0 12px 40px rgba(0,0,0,0.4); transform-origin:center; animation:spin 3s linear infinite;}
    .splash .text{font-weight:600; opacity:0.95;}
    @keyframes spin{from{transform:rotate(0)} to{transform:rotate(360deg)}}

    /* -------------------------
       Layout header
       ------------------------- */
    .wrap{position:relative; min-height:100vh; z-index:10;}
    header.app-header{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:14px 20px; background:rgba(255,255,255,0.8);
      backdrop-filter: blur(6px); box-shadow:0 6px 20px rgba(2,6,23,0.06);
    }
    body.dark header.app-header{ background:rgba(10,18,28,0.6); box-shadow:0 6px 20px rgba(0,0,0,0.6); }

    .brand{display:flex; align-items:center; gap:12px;}
    .brand img{width:44px; height:44px; border-radius:9px; object-fit:cover;}
    .brand h1{font-size:1.05rem; margin:0; font-weight:700; letter-spacing:-0.2px;}

    .header-actions{display:flex; align-items:center; gap:8px;}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; cursor:pointer; border:none; font-weight:600;
      background:var(--primary); color:white; box-shadow:0 6px 18px rgba(79,70,229,0.12);
    }
    .btn.secondary{ background:transparent; border:1px solid rgba(0,0,0,0.06); color:inherit; font-weight:600; box-shadow:none;}
    .small{padding:6px 10px; font-size:0.9rem;}

    .theme-toggle{background:rgba(0,0,0,0.06); color:inherit; border-radius:10px; padding:8px; font-weight:700;}

    /* -------------------------
       Content area
       ------------------------- */
    main.container{ max-width:1200px; margin:28px auto; padding:0 18px 80px; z-index:20; position:relative;}
    h2.title{ text-align:center; margin:6px 0 18px; color:var(--primary-600); font-size:1.5rem; }

    /* Controls */
    .controls{display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:18px;}
    .search{
      display:flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; min-width:260px;
      background:var(--card-light); box-shadow:0 6px 18px rgba(2,6,23,0.04); border:1px solid rgba(0,0,0,0.04);
    }
    .search input{ border:none; outline:none; font-size:14px; min-width:180px; background:transparent; color:inherit; }
    .select, .tiny-btn{ padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.06); background:var(--card-light); }

    body.dark .search, body.dark .select{ background:#0b1220; border:1px solid rgba(255,255,255,0.04); box-shadow:none; }

    /* Grid */
    .apps-grid{ display:grid; gap:16px; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); align-items:stretch; }

    .card{
      background:var(--card-light); padding:14px; border-radius:14px; position:relative; overflow:hidden;
      box-shadow:0 10px 30px rgba(2,6,23,0.06); transition: transform 0.28s cubic-bezier(.2,.8,.2,1), box-shadow .28s;
      display:flex; flex-direction:column; gap:10px; min-height:220px;
    }
    body.dark .card{ background:var(--card-dark); box-shadow:0 8px 26px rgba(0,0,0,0.6); }

    .card:hover{ transform:translateY(-8px); box-shadow:0 18px 44px rgba(2,6,23,0.12); }

    .meta{ display:flex; gap:12px; align-items:center; }
    .meta img{ width:64px; height:64px; border-radius:12px; object-fit:cover; }
    .meta .info h3{ margin:0; font-size:1.05rem; color:var(--primary-600); }
    .meta .info small{ color: #6b7280; display:block; margin-top:6px; font-size:0.86rem; }

    .desc{ color:#374151; font-size:0.95rem; line-height:1.35; flex:1; }
    body.dark .desc{ color:#d1d5db; }

    .card-actions{ display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:6px; }
    .card .link-apk{ color:var(--accent); font-weight:600; font-size:0.92rem; text-decoration:none; }

    /* Delete / Edit */
    .danger{ background:var(--danger); color:white; padding:8px 12px; border-radius:10px; font-weight:700; }
    .edit{ background:transparent; border:1px solid rgba(0,0,0,0.06); padding:8px 12px; border-radius:10px; }

    body.dark .edit{ border-color: rgba(255,255,255,0.06); }

    /* Animations for delete */
    @keyframes slideFade {
      0% {opacity:1; transform:translateX(0);}
      100% {opacity:0; transform:translateX(90px) scale(.98);}
    }

    /* Toast */
    .toast{ position:fixed; right:18px; bottom:18px; background: #10b981; color:white; padding:12px 18px; border-radius:10px; box-shadow:0 12px 40px rgba(2,6,23,0.18); opacity:0; transform: translateY(8px); transition:all .32s; z-index:9999;}
    .toast.show{ opacity:1; transform: translateY(0); }

    /* Modal (edit) */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.45); display:flex; align-items:center; justify-content:center; z-index:9998; padding:20px; }
    .modal{
      width:100%; max-width:760px; background:var(--card-light); border-radius:12px; padding:18px; box-shadow:0 20px 60px rgba(2,6,23,0.35);
    }
    body.dark .modal{ background:#0f1724; color:var(--text-dark); }

    .modal .row{ display:flex; gap:12px; margin-bottom:12px; align-items:center; }
    .modal label{ font-weight:700; font-size:0.9rem; margin-bottom:6px; display:block; }
    .modal input[type="text"], .modal textarea{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); }
    .modal input[type="file"]{ padding:8px; }
    .modal .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }

    /* Preview image */
    .preview{ width:92px; height:92px; border-radius:10px; object-fit:cover; border:1px solid rgba(0,0,0,0.06); }
    body.dark .preview{ border-color: rgba(255,255,255,0.06); }

    /* Loading small */
    .spinner{ width:14px; height:14px; border-radius:999px; border:3px solid rgba(255,255,255,0.2); border-top-color:white; animation:spin1 .7s linear infinite; display:inline-block; }
    @keyframes spin1{ to{ transform:rotate(360deg); } }

    /* responsive tweaks */
    @media (max-width:720px){
      .meta img{ width:56px; height:56px; }
      .card{ padding:12px; }
      header.app-header{ padding:12px; }
      main.container{ padding:0 14px; }
    }
  </style>
</head>
<body>

  <!-- Burbujas -->
  <div class="bubble b1"></div>
  <div class="bubble b2"></div>
  <div class="bubble b3"></div>
  <div class="bubble b4"></div>
  <div class="bubble b5"></div>

  <!-- SPLASH -->
  <div class="splash" id="splash">
    <div class="logo" aria-hidden="true">üí†</div>
    <div class="text">Cargando panel... <span style="opacity:.85;display:inline-block;margin-left:8px;">(casi listo)</span></div>
  </div>

  <div class="wrap">
    <!-- HEADER -->
    <header class="app-header">
      <div class="brand">
        <img src="logo.png" alt="logo" />
        <div>
          <h1>My Store ¬∑ Panel</h1>
          <small style="color:#6b7280;">Gesti√≥n de aplicaciones</small>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn small" id="refreshBtn">üîÑ Actualizar</button>
        <button class="btn small" id="newBtn" style="background:var(--accent); box-shadow:0 6px 20px rgba(6,182,212,0.18)">‚ûï Nueva app</button>
        <button class="btn small theme-toggle" id="themeBtn">üåô</button>
        <button class="btn small secondary" id="logoutBtn" style="background:transparent; border:1px solid rgba(0,0,0,0.06)">Cerrar sesi√≥n</button>
      </div>
    </header>

    <!-- MAIN -->
    <main class="container">
      <h2 class="title">üìã Administrar Aplicaciones</h2>

      <!-- CONTROLS -->
      <div class="controls">
        <div class="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="5" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" type="text" placeholder="Buscar por nombre..." />
        </div>

        <select id="categorySelect" class="select">
          <option value="">Todas las categor√≠as</option>
        </select>

        <select id="sortSelect" class="select">
          <option value="new">M√°s recientes</option>
          <option value="old">M√°s antiguas</option>
          <option value="name_asc">Nombre A ‚Üí Z</option>
          <option value="name_desc">Nombre Z ‚Üí A</option>
        </select>

        <button class="tiny-btn" id="clearFilter">Limpiar</button>
      </div>

      <!-- GRID -->
      <div id="appsGrid" class="apps-grid">
        <!-- cards injected here -->
      </div>
    </main>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- EDIT / CREATE MODAL (hidden by default) -->
  <div id="modalBackdrop" class="modal-backdrop" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Editar aplicaci√≥n</h3>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <div style="flex:1;min-width:240px;">
          <label>Nombre</label>
          <input id="modalName" type="text" placeholder="Nombre de la app" />
        </div>
        <div style="width:120px">
          <label>Preview</label>
          <img id="modalPreview" class="preview" src="" alt="preview" />
        </div>
      </div>

      <div style="margin-top:10px;">
        <label>Descripci√≥n</label>
        <textarea id="modalDesc" rows="4" placeholder="Descripci√≥n corta"></textarea>
      </div>

      <div style="display:flex;gap:12px; margin-top:8px; flex-wrap:wrap; align-items:center;">
        <div>
          <label>Imagen (PNG/JPG)</label>
          <input id="modalImage" type="file" accept="image/*" />
        </div>
        <div>
          <label>APK</label>
          <input id="modalApk" type="file" accept=".apk" />
        </div>
      </div>

      <div class="actions" style="display:flex;justify-content:flex-end;margin-top:12px;gap:8px;">
        <button id="modalCancel" class="btn secondary">Cancelar</button>
        <button id="modalSave" class="btn" style="background:var(--primary-600)">Guardar cambios</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Estado ----------
    let apps = [];
    let filter = { q:'', category:'', sort:'new' };
    let editingId = null;
    const toastEl = document.getElementById('toast');
    const appsGrid = document.getElementById('appsGrid');

    // ---------- Helpers ----------
    function showToast(msg, ok=true){
      toastEl.textContent = msg;
      toastEl.style.background = ok ? '#10b981' : '#ef4444';
      toastEl.classList.add('show');
      setTimeout(()=>toastEl.classList.remove('show'), 3000);
    }

    function formatDate(sqlDate){
      try{
        const d = new Date(sqlDate);
        return d.toLocaleString();
      }catch{ return sqlDate; }
    }

    // ---------- Fetch & render ----------
    async function fetchApps(){
      try{
        document.getElementById('refreshBtn').textContent = '‚è≥ Cargando...';
        document.getElementById('refreshBtn').disabled = true;

        const res = await fetch('/api/apps');
        if(!res.ok) throw new Error('No se pudo obtener apps');
        apps = await res.json();
        renderApps();
        populateCategories();
      }catch(err){
        console.error(err);
        appsGrid.innerHTML = '<p style="color:#ef4444">Error cargando apps. Revisa el servidor.</p>';
      }finally{
        document.getElementById('refreshBtn').textContent = 'üîÑ Actualizar';
        document.getElementById('refreshBtn').disabled = false;
      }
    }

    function renderApps(){
      const q = filter.q.trim().toLowerCase();
      let list = apps.filter(a => (a.name && a.name.toLowerCase().includes(q)) || (a.description && a.description.toLowerCase().includes(q)));
      if(filter.category) list = list.filter(a=>a.category===filter.category);

      // sorting
      if(filter.sort==='new') list.sort((a,b)=> new Date(b.created_at) - new Date(a.created_at));
      if(filter.sort==='old') list.sort((a,b)=> new Date(a.created_at) - new Date(b.created_at));
      if(filter.sort==='name_asc') list.sort((a,b)=> a.name.localeCompare(b.name));
      if(filter.sort==='name_desc') list.sort((a,b)=> b.name.localeCompare(a.name));

      if(list.length===0){
        appsGrid.innerHTML = '<p style="text-align:center; color:#6b7280;">No se encontraron aplicaciones.</p>';
        return;
      }

      appsGrid.innerHTML = '';
      list.forEach((app, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.animationDelay = (idx*40)+'ms';
        card.innerHTML = `
          <div class="meta">
            <img src="${app.image || 'placeholder.png'}" alt="${escapeHtml(app.name)}" />
            <div class="info">
              <h3>${escapeHtml(app.name)}</h3>
              <small>${escapeHtml(app.category || 'Sin categor√≠a')} ¬∑ ${formatDate(app.created_at || '')}</small>
            </div>
          </div>
          <div class="desc">${escapeHtml(app.description || '')}</div>
          <div class="card-actions">
            <a class="link-apk" href="${app.apk}" target="_blank" rel="noopener">‚¨áÔ∏è Descargar APK</a>
            <button class="edit" onclick="openEdit(${app.id})">‚úèÔ∏è Editar</button>
            <button class="danger" onclick="confirmDelete(${app.id}, this)">üóëÔ∏è Eliminar</button>
          </div>
        `;
        appsGrid.appendChild(card);
      });
    }

    function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]); }

    function populateCategories(){
      const set = new Set(apps.map(a => a.category).filter(Boolean));
      const sel = document.getElementById('categorySelect');
      sel.innerHTML = '<option value="">Todas las categor√≠as</option>';
      set.forEach(c => {
        const o = document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o);
      });
    }

    // ---------- Delete ----------
    async function confirmDelete(id, btn){
      const ok = confirm('¬øSeguro que deseas eliminar esta app? Esta acci√≥n es irreversible.');
      if(!ok) return;
      try{
        btn.disabled = true;
        btn.textContent = 'Eliminando...';
        const res = await fetch(`/apps/${id}`, { method:'DELETE' });
        const data = await res.json();
        if(res.ok){
          // animate removal visually
          const card = btn.closest('.card');
          card.style.animation = 'slideFade 0.6s forwards';
          setTimeout(()=>card.remove(), 650);
          // also update local apps array
          apps = apps.filter(a=>a.id!==id);
          showToast(data.message || 'Eliminado');
        } else {
          showToast(data.message || 'Error al eliminar', false);
          btn.disabled = false; btn.textContent = 'üóëÔ∏è Eliminar';
        }
      }catch(err){
        console.error(err);
        showToast('Error de conexi√≥n', false);
        btn.disabled = false; btn.textContent = 'üóëÔ∏è Eliminar';
      }
    }

    // ---------- Modal (create/edit) ----------
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalName = document.getElementById('modalName');
    const modalDesc = document.getElementById('modalDesc');
    const modalImage = document.getElementById('modalImage');
    const modalApk = document.getElementById('modalApk');
    const modalPreview = document.getElementById('modalPreview');
    const modalSave = document.getElementById('modalSave');
    const modalCancel = document.getElementById('modalCancel');
    const newBtn = document.getElementById('newBtn');

    newBtn.addEventListener('click', ()=>openCreate());

    function openCreate(){
      editingId = null;
      modalTitle.textContent = 'Crear nueva aplicaci√≥n';
      modalName.value = '';
      modalDesc.value = '';
      modalPreview.src = 'placeholder.png';
      modalImage.value = '';
      modalApk.value = '';
      modalBackdrop.style.display = 'flex';
    }

    function openEdit(id){
      editingId = id;
      const app = apps.find(a=>a.id===id);
      if(!app){ showToast('App no encontrada', false); return; }
      modalTitle.textContent = 'Editar aplicaci√≥n';
      modalName.value = app.name || '';
      modalDesc.value = app.description || '';
      modalPreview.src = app.image || 'placeholder.png';
      modalImage.value = '';
      modalApk.value = '';
      modalBackdrop.style.display = 'flex';
    }

    modalCancel.addEventListener('click', ()=>{ modalBackdrop.style.display='none'; });

    // preview image on choose
    modalImage.addEventListener('change', (e)=> {
      const f = e.target.files[0];
      if(f) modalPreview.src = URL.createObjectURL(f);
    });

    // SAVE (create or update)
    modalSave.addEventListener('click', async ()=>{
      const name = modalName.value.trim();
      const desc = modalDesc.value.trim();
      if(!name || !desc){ alert('Nombre y descripci√≥n son obligatorios'); return; }

      modalSave.disabled = true;
      modalSave.textContent = '‚è≥ Guardando...';

      try{
        const fd = new FormData();
        fd.append('name', name);
        fd.append('description', desc);
        if(modalImage.files[0]) fd.append('image', modalImage.files[0]);
        if(modalApk.files[0]) fd.append('apk', modalApk.files[0]);

        let res;
        if(editingId){
          res = await fetch(`/apps/${editingId}`, { method:'PUT', body: fd });
        } else {
          res = await fetch('/apps', { method:'POST', body: fd }); // backend create route ‚Äî if not present, will return 404
        }

        const data = await res.json();
        if(!res.ok) { throw new Error(data.message || 'Error en servidor'); }

        showToast(editingId ? 'Actualizaci√≥n guardada' : 'App creada');
        modalBackdrop.style.display = 'none';
        // refresh list
        await fetchApps();
      }catch(err){
        console.error(err);
        showToast(err.message || 'Error', false);
      }finally{
        modalSave.disabled = false;
        modalSave.textContent = 'Guardar cambios';
      }
    });

    // ---------- Filters / controls ----------
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');
    const sortSelect = document.getElementById('sortSelect');
    const clearFilterBtn = document.getElementById('clearFilter');

    searchInput.addEventListener('input', (e)=>{ filter.q = e.target.value; renderApps(); });
    categorySelect.addEventListener('change', (e)=>{ filter.category = e.target.value; renderApps(); });
    sortSelect.addEventListener('change', (e)=>{ filter.sort = e.target.value; renderApps(); });
    clearFilterBtn.addEventListener('click', ()=>{ searchInput.value=''; categorySelect.value=''; sortSelect.value='new'; filter={q:'',category:'',sort:'new'}; renderApps(); });

    // populate category select helper
    function populateCategories(){
      const set = new Set(apps.map(a=>a.category).filter(Boolean));
      const sel = categorySelect;
      const current = sel.value;
      sel.innerHTML = '<option value="">Todas las categor√≠as</option>';
      set.forEach(c=>{
        const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o);
      });
      if([...set].includes(current)) sel.value=current;
    }

    // ---------- Refresh / logout / theme ----------
    document.getElementById('refreshBtn').addEventListener('click', fetchApps);

    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      if(!confirm('¬øCerrar sesi√≥n?')) return;
      fetch('/logout',{method:'POST'}).then(()=> location.href='/login.html').catch(()=> showToast('Error al cerrar sesi√≥n', false));
    });

    const themeBtn = document.getElementById('themeBtn');
    (function initTheme(){
      const t = localStorage.getItem('theme');
      if(t==='dark'){ document.body.classList.add('dark'); themeBtn.textContent='‚òÄÔ∏è'; }
      else themeBtn.textContent='üåô';
    })();
    themeBtn.addEventListener('click', ()=>{
      const dark = document.body.classList.toggle('dark');
      themeBtn.textContent = dark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('theme', dark ? 'dark' : 'light');
    });

    // ---------- New app quick route (open upload page) ----------
    // If you prefer to use upload.html to create, you can redirect; otherwise modal Create will be used.
    document.getElementById('newBtn').addEventListener('click', ()=>{
      // If you want to use the upload page: uncomment next line and comment openCreate()
      // window.location.href = 'upload.html';
      openCreate();
    });

    // ---------- Escape key closes modal ----------
    window.addEventListener('keydown', (e)=> {
      if(e.key==='Escape') modalBackdrop.style.display='none';
    });

    // ---------- safe initial hide splash and load ----------
    window.addEventListener('load', ()=>{
      setTimeout(()=> {
        const s = document.getElementById('splash');
        s.style.transition = 'opacity .9s'; s.style.opacity = 0;
        setTimeout(()=> s.style.display='none', 900);
        fetchApps();
      }, 900);
    });

    // ---------- small utility: create app endpoint if not exists ----------
    // Note: frontend assumes these endpoints:
    // GET  /api/apps        -> list apps (we use)
    // DELETE /apps/:id      -> delete (we use)
    // PUT /apps/:id         -> update (used by modal)
    // POST /apps            -> create (used by modal)
    //
    // If your backend doesn't have POST /apps or PUT /apps/:id, these calls will return errors. Backend changes needed:
    // - POST /apps: same behavior as /upload but returns created app JSON
    // - PUT /apps/:id: accept FormData for fields and return updated app JSON

  </script>
</body>
</html>
